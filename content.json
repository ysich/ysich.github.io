{"meta":{"title":"ysich-game-blog","subtitle":"","description":"","author":"ysich","url":"http://ysich.github.io","root":"/"},"pages":[],"posts":[{"title":"æ¸¸æˆèµ„æºç®¡ç†","slug":"æ¸¸æˆèµ„æºç®¡ç†","date":"2023-01-16T04:56:44.000Z","updated":"2023-01-16T05:00:11.899Z","comments":true,"path":"2023/01/16/æ¸¸æˆèµ„æºç®¡ç†/","link":"","permalink":"http://ysich.github.io/2023/01/16/%E6%B8%B8%E6%88%8F%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/","excerpt":"","text":"æ¸¸æˆèµ„æºç®¡ç†æ¸¸æˆè¿è¡Œå°±æ˜¯ä¸€ä¸ªæ¥ä¸€ä¸ªèµ„æºçš„å±•ç¤ºï¼Œå¦‚ä½•ç®¡ç†å¥½è¿™äº›å±•ç¤ºçš„èµ„æºè®©æ¸¸æˆèƒ½å¤Ÿæµç•…è¿è¡Œåœ¨å¼€å‘ä¸­éå¸¸é‡è¦ã€‚éœ€è¦åœ¨åˆç†çš„åœ°æ–¹è°ƒç”¨ã€åŠ è½½èµ„æºï¼Œèµ„æºç©ºé—²æ—¶å¯¹å…¶è¿›è¡Œå¸è½½ä»¥å‡å°‘å†…å­˜å ç”¨ã€‚å½“å†…å­˜è¶…å‡ºé¢„ç®—å¯èƒ½å¯¼è‡´æ¸¸æˆé—ªé€€ï¼Œæ‰€ä»¥å¯¹èµ„æºçš„ç®¡ç†å®é™…å°±æ˜¯å¯¹å†…å­˜çš„ä¼˜åŒ–ï¼ æœ¬æ–‡äº‰å–ä¸€æ–‡ææ‡‚èµ„æºç®¡ç†ã€‚PSï¼šå¯èƒ½å’Œä¸€ä¸ªè§†é¢‘å­¦å®Œc++å·®ä¸å¤š(ä¸€ä¸ªè§†é¢‘ä¸€ä¸ªå¤šæœˆ) TODOLISTï¼š åˆ†åŒ…ç­–ç•¥ ä¾èµ–å¤„ç† AssetBundleè¯¦ç»† çƒ­æ›´ æ–­ç‚¹ç»­ä¼  ä»£ç çƒ­æ›´æ–°/çƒ­é‡è½½ Luaé‡æ–°å°†å‡½æ•°æŒ‡é’ˆèµ‹å€¼çš„ç­–ç•¥ HybridCLR èµ„æºåŒ…å’Œèµ„æºåŒºåˆ†å¼€ ä¸€äº›èµ„æºç­–ç•¥ æ•´åŒ…åªæœ‰åŸºç¡€å†…å®¹ï¼Œåç»­ç« èŠ‚çƒ­æ›´çš„å½¢å¼(å¤§èµ„æºæƒ…å†µ) YooAssetæ‰©å±•ç¯‡ èµ„æºç®¡ç†ä¸»è¦çš„éœ€æ±‚æœ‰å“ªäº›ï¼Ÿ ä¸ºå¼€å‘ä¸æ­£å¼ç‰ˆæœ¬æä¾›èµ„æºçš„åŠ è½½å’Œå¸è½½ æ”¯æŒè¿œç¨‹æ›´æ–°èµ„æº åšå¥½ç‰ˆæœ¬ã€å¹³å°ã€æ¸ é“çš„èµ„æºç®¡ç† å†…å­˜ä¼˜åŒ– Unityä¸­çš„ä¸¤ç§åŠ è½½æ–¹å¼Resources èµ„æºå¿…é€‰æ”¾åœ¨Resourcesæ–‡ä»¶å¤¹ä¸‹ï¼›æœ‰å®¹é‡ä¸Šé™(å¤§æ¦‚æ˜¯2G)ï¼›é‡å¤åŠ è½½å’Œé‡å¤å¸è½½æ“ä½œï¼ŒUnityåšäº†å®¹é”™å¤„ç†ä¸ä¼šæŠ¥é”™ã€‚ä¸æ”¯æŒçƒ­æ›´ï¼Œåªèƒ½æ‰“æ•´åŒ… é€‚åˆæ”¾æ¸¸æˆçš„å¯åŠ¨é€»è¾‘éœ€è¦çš„èµ„æº å¯èƒ½ä¼šå»¶é•¿æ¸¸æˆå¯åŠ¨æ—¶é—´ AssetBundle å¯ä»¥ç†è§£æˆUnityå†…çš„èµ„æºå‹ç¼©åŒ…ï¼Œæœ‰ä¸åŒçš„å‹ç¼©æ–¹å¼ï¼Œè§£å‹é€Ÿåº¦å’ŒåŒ…ä½“å¤§å°ä¹Ÿä¸åŒ(LZMA å’Œ LZ4)ã€‚ é€‚åˆåšçƒ­æ›´ï¼Œä»¥å‡å°‘åŒ…ä½“çš„åˆå§‹å¤§å°ã€‚ å·²åŠ è½½çš„èµ„æºä¸å…è®¸é‡å¤åŠ è½½ï¼Œä¼šæŠ¥é”™ã€‚è€Œä½¿ç”¨AssetDatabaseåˆ™ä¸éœ€è¦è€ƒè™‘ã€‚éœ€è¦ä½¿ç”¨å¼•ç”¨è®¡æ•°ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€äº›å¼€æºçš„èµ„æºç®¡ç†ç³»ç»Ÿï¼Œå¦‚YooAssetã€‚ åŒæ­¥åŠ è½½ä¸å¼‚æ­¥åŠ è½½åŒæ­¥åŠ è½½åŒæ­¥åŠ è½½åœ¨åŠ è½½èµ„æºæ—¶ï¼Œä¼šé˜»å¡çº¿ç¨‹ã€‚ç­‰åŠ è½½é€»è¾‘å®Œæˆåæ‰ç»§ç»­æ‰§è¡Œåç»­é€»è¾‘ï¼ˆå›¾çµæœºï¼‰ å¼‚æ­¥åŠ è½½åŒæ­¥åŠ è½½åœ¨åŠ è½½è¾ƒå¤§èµ„æºæ—¶é˜»å¡æ˜æ˜¾ï¼Œé€ æˆå¡é¡¿ã€‚å› ä¸ºUnityä¸­æ‰€æœ‰çš„æ¸²æŸ“éƒ½æ˜¯æ”¾åœ¨ä¸»çº¿ç¨‹ä¸­çš„ï¼Œæ‰€ä»¥ä¸»çº¿ç¨‹é˜»å¡éå¸¸è‡´å‘½ä¸èƒ½è¿›è¡Œä»»ä½•ç©å®¶æ“ä½œã€‚ æ‰€ä»¥éœ€è¦ä½¿ç”¨å¦å¤–ä¸€ç§åŠ è½½æ–¹å¼å¯¹è¾ƒå¤§èµ„æºè¿›è¡ŒåŠ è½½ã€‚å¼‚æ­¥åŠ è½½ä½¿ç”¨åç¨‹/çº¿ç¨‹è¿›è¡ŒåŠ è½½é€»è¾‘ï¼Œç­‰èµ„æºåŠ è½½å®Œæ¯•åè§¦å‘èµ„æºåŠ è½½åçš„callbackã€‚ åœ¨ä¸€äº›èµ„æºçš„åŠ è½½ä¼šå½±å“åˆ°æ¸¸æˆçš„å±•ç¤ºæ—¶ï¼Œå¯ä»¥åœ¨éœ€è¦ä¹‹å‰å¯¹èµ„æºè¿›è¡Œé¢„å…ˆåŠ è½½ï¼Œä¿è¯æµç¨‹èƒ½å¤Ÿé¡ºåˆ©è¿›è¡Œã€‚ å¼‚æ­¥åŠ è½½çš„ä¸‰ç§çŠ¶æ€å¼‚æ­¥åŠ è½½çš„é€»è¾‘ç”±äºæ‰§è¡Œå®Œæˆçš„æ—¶é—´ä¸ç¡®å®šï¼Œå¯èƒ½ä¼šå¯¼è‡´å…¶ä»–é€»è¾‘çš„å†²çªã€‚æ‰€ä»¥æˆ‘ä»¬ç»™å¼‚æ­¥åŠ è½½æŒ‰ç…§é€»è¾‘åˆ’åˆ†çŠ¶æ€ï¼Œå¥½è®©å…¶ä»–é€»è¾‘èƒ½å¤ŸåšåŒºåˆ†ï¼Œä¸åŒçŠ¶æ€ä¸‹å¤„ç†ç›¸åº”çš„æ“ä½œã€‚ æœªåŠ è½½ å¼‚æ­¥åŠ è½½è¿˜æ²¡å¼€å§‹æ—¶å¯èƒ½éœ€è¦å‡†å¤‡çš„äº‹æƒ…ï¼Œæ¯”å¦‚èµ„æºåŒ…ä¸åœ¨æœ¬åœ°éœ€è¦ä¸‹è½½ã€è§£å¯†ã€è§£å‹ç­‰ç­‰ã€‚ åŠ è½½ä¸­ èµ„æºå¼€å§‹åŠ è½½åï¼Œå…¶ä»–ä¸šåŠ¡é€»è¾‘ä¹ŸåŠ è½½äº†ç›¸åŒèµ„æºæ—¶ï¼Œå¯ä»¥åˆ¤æ–­è¿™ä¸ªèµ„æºçš„çŠ¶æ€ã€‚æ­£åœ¨åŠ è½½åˆ™ä¸å†è¿›è¡ŒåŠ è½½å‰çš„å‡†å¤‡æ“ä½œï¼Œå¹¶æŠŠåŠ è½½åçš„callbackæ³¨å†Œè¿›å»ã€‚ å·²åŠ è½½ ä¸»è¦ä¸ºåŠ è½½åè§¦å‘ç›¸åº”callbackã€‚ 123456public enum LoaderState { NONE, // é»˜è®¤ LOADING, // åŠ è½½ä¸­ FINISHED, // å®Œæˆ } å­˜åœ¨é—®é¢˜ç©å®¶åœ¨è¿›å…¥ä¸€ä¸ªåœºæ™¯åï¼Œå‡è®¾èµ„æºé¢„åŠ è½½éœ€è¦10sï¼Œç©å®¶å´åœ¨æœªåŠ è½½å®Œèµ„æºçš„è¿‡ç¨‹ä¸­é€€å‡ºåœºæ™¯ã€‚è¿™æ—¶å€™å°±ä¼šå¼•å‘èµ„æºçŠ¶æ€çš„é—®é¢˜ã€‚ èµ„æºç¼“å­˜æ± èµ„æºç¼“å­˜æ± ä¸ºç»Ÿä¸€å­˜å‚¨å’Œè°ƒç”¨èµ„æºçš„åœ°æ–¹ã€‚åœ¨åŠ è½½èµ„æºåç»Ÿä¸€å­˜å…¥æ± å­ä¸­ï¼Œå¸è½½æ—¶åˆ™å°†å…¶ä»æ± å­ä¸­åˆ é™¤ã€‚ åŠ è½½æ—¶å…ˆåˆ¤æ–­æ± å­ä¸­æ˜¯å¦å­˜åœ¨æ­¤èµ„æºåŒ…ï¼Œå¦‚æœå·²ç»åŠ è½½è¿‡äº†ç›´æ¥åˆ™ç›´æ¥ä½¿ç”¨ï¼ŒæœªåŠ è½½å†è¿›è¡ŒåŠ è½½é€»è¾‘ã€‚ ä»¥ä¸‹å†…å®¹ä¸»è¦ä»¥AssetBundleä¸¾ä¾‹ 123public class AssetBundlePool{ private Dictionary&lt;string,AssetBundleInfo&gt; m_LoadAssetBundle = new Dictionary&lt;string,AssetBundleInfo&gt;();} å¼•ç”¨è®¡æ•°åŸºç¡€æ¦‚å¿µå¼•ç”¨æŠ€æœ¯çš„åº”ç”¨èŒƒå›´å¾ˆå¹¿ï¼Œå¾ˆå¤šå¼•æ“ã€æ¡†æ¶ã€æ’ä»¶çš„åº•å±‚éƒ½ç¦»ä¸å¼€å¼•ç”¨è®¡æ•°ã€‚ ç®€å•æ€æƒ³ï¼šè¢«å¼•ç”¨+1ï¼Œä¸è¢«å¼•ç”¨æ—¶-1ï¼Œå½“ä¸º0æ—¶è§¦å‘æ¸…ç©ºé€»è¾‘ã€‚ 123456789101112131415161718192021public interface IRefCounter{ int RefCount { get; } void Retain(); void Release();}public class SimpleRC : IRefCounter{ public int RefCount { get; private set; } public void Retain() { RefCount++; } public void Release() { RefCount--; if (RefCount == 0){ OnZeroRef(); } } protected virtual void OnZeroRef(){}} ä¸èµ„æºç®¡ç†ç»“åˆçš„å¼•ç”¨è®¡æ•°èµ„æºè¢«ä½¿ç”¨æ—¶å¼•ç”¨æ¬¡æ•°+1ï¼Œèµ„æºè§£é™¤ä½¿ç”¨æ—¶æ¬¡æ•°-1ï¼Œå½“å¼•ç”¨æ¬¡æ•°ä¸º0æ—¶åˆ™è¿›è¡Œå¸è½½é€»è¾‘ã€‚ 1234567891011public class AssetBundleInfo{ private AssetBundle m_AssetBundle; //ABåŒ…å¼•ç”¨ public AssetBundle AssetBundle { get { return m_AssetBundle; } } public int m_ReferencedCount; //å¼•ç”¨è®¡æ•° public AssetBundleInfo(AssetBundle assetBundle) { m_AssetBundle = assetBundle; m_ReferencedCount = 1; }} ä¸èµ„æºç¼“å†²æ± ç»“åˆçš„åŠ è½½123456789101112131415161718192021222324252627public class AssetBundlePool{ private Dictionary&lt;string,AssetBundleInfo&gt; m_LoadAssetBundle = new Dictionary&lt;string,AssetBundleInfo&gt;(); public AssetBundle LoadAssetsFromAB(string abName) { AssetBundleInfo assetBundleInfo = null; if (m_LoadAssetBundle.TryGetValue(abName, out assetBundleInfo)) { //æ£€æŸ¥æ˜¯å¦åŠ è½½è¿‡ assetBundleInfo.m_ReferencedCount++;//è¿™é‡Œå¯ä»¥ä½¿ç”¨å°è£…å¥½çš„å¼•ç”¨è®¡æ•°ï¼Œä¸ºäº†æ–¹ä¾¿å±•ç¤ºç›´æ¥ä½¿ç”¨ } else { string loadPath = PathUnit.DataPath + PathUnit.ABRootPath + abName; var ab = AssetBundle.LoadFromFile(loadPath); if (ab is null) { Debug.Log(\"ABåŒ…åŠ è½½å¤±è´¥ï¼\"+ loadPath); } else { assetBundleInfo = new AssetBundleInfo(ab); m_LoadAssetBundle.Add(abName, assetBundleInfo); //assetBundleInfo.m_ReferencedCount++;è¿™é‡Œä¸éœ€è¦åŠ äº†å› ä¸ºé»˜è®¤å€¼ä¸º1 } } return assetBundleInfo.AssetBundle; }} å¼‚æ­¥åŠ è½½ä¹Ÿæ˜¯ç›¸åŒçš„æ“ä½œï¼Œä½†æœ‰ç‚¹ä¸åŒã€‚éœ€è¦ä¸€ä¸ªé¢å¤–çš„é˜Ÿåˆ—è®°å½•åŠ è½½ä¸­çš„æ–‡ä»¶ã€‚å½“åŠ è½½ä¸­çš„æ–‡ä»¶åˆæ”¶åˆ°äº†åŠ è½½è¯·æ±‚æ—¶ï¼Œåˆ™éœ€è¦åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾æ˜¯å¦æ­£åœ¨åŠ è½½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465public class AssetBundleCachePool{ public MonoBehaviour monoBehaviour; private Dictionary&lt;string, AssetBundleInfo&gt; m_LoadAssetBundle = new Dictionary&lt;string, AssetBundleInfo&gt;(); private Dictionary&lt;string, Action&lt;AssetBundle&gt;&gt; m_LoadingAssetBundle = new Dictionary&lt;string, Action&lt;AssetBundle&gt;&gt;(); public void LoadAssetsFormAbAsync(string abName, Action&lt;AssetBundle&gt; loadingABAction) { monoBehaviour.StartCoroutine(OnLoadAssetsFormAbAsync(abName, loadingABAction)); } IEnumerator OnLoadAssetsFormAbAsync(string abName, Action&lt;AssetBundle&gt; loadingABAction) { AssetBundleInfo assetBundleInfo = null; if (m_LoadAssetBundle.TryGetValue(abName,out assetBundleInfo)) { Debug.Log(\"å·²åŠ è½½è¿‡\"); AssetBundle assetBundle = assetBundleInfo.AssetBundle; //å¼•ç”¨è®¡æ•°+1 assetBundleInfo.m_ReferencedCount++; //è§¦å‘å›è°ƒ if (loadingABAction != null) { loadingABAction.Invoke(assetBundle); } yield break; } else { if (m_LoadingAssetBundle.TryGetValue(abName,out Action&lt;AssetBundle&gt; temploadingABAction)) { if (loadingABAction != null) { temploadingABAction += loadingABAction; } Debug.Log(\"æ­£åœ¨è¢«åŠ è½½\"); yield break; } else { //è¿™æ­¥éœ€è¦æ‰§è¡Œï¼Œé¿å…ä¸å…¶ä»–é€»è¾‘å†²çª m_LoadingAssetBundle.Add(abName, loadingABAction); string loadPath = PathUnit.DataPath + PathUnit.ABRootPath + abName; AssetBundleCreateRequest assetBundleCreateRequest = AssetBundle.LoadFromFileAsync(loadPath); AssetBundle resAB = assetBundleCreateRequest.assetBundle; if (resAB is null) { Debug.LogError(\"ABåŒ…ä¸èƒ½å­˜åœ¨\"); } else { assetBundleInfo = new AssetBundleInfo(resAB); m_LoadAssetBundle.Add(abName, assetBundleInfo); } //åŠ è½½å®Œæˆç§»é™¤åŠ è½½ä¸­åˆ—è¡¨ //é¿å…å•¥å¼‚å¸¸çŠ¶å†µï¼Œä¿é™©ç‚¹ï¼å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ if (m_LoadingAssetBundle.ContainsKey(abName)) { Action&lt;AssetBundle&gt; action = m_LoadingAssetBundle[abName]; m_LoadingAssetBundle.Remove(abName); var callBackList = action.GetInvocationList(); foreach (Action&lt;AssetBundle&gt; callBack in callBackList) { callBack.Invoke(resAB); } } } } }} ä¸èµ„æºç¼“å†²æ± ç»“åˆçš„å¸è½½ä¸ºäº†ä¿æŒå¹³è¡¡æœ‰äº†åŠ è½½å°±ä¸€å®šä¼šæœ‰å¸è½½ã€‚ä½†æ˜¯åœ¨æ¸¸æˆä¸­(ç‰¹åˆ«æ˜¯æ‰‹æ¸¸)å¸è½½æ“ä½œéœ€è¦åŠ ä¸Šä¸€äº›é™åˆ¶ï¼Œå› ä¸ºåœ¨çŸ­æ—¶é—´å†…è¿›è¡Œäº†å¤§é‡èµ„æºçš„å¸è½½å¢åŠ äº†å¤§é‡çš„IOæ“ä½œä¹Ÿä¼šé€ æˆå¡é¡¿ï¼ˆçº¿ç¨‹é˜»å¡ï¼‰çš„ã€‚ğŸ™‚ æ‰€ä»¥æˆ‘ä»¬çš„å¸è½½æ“ä½œéœ€è¦ä¸æ•°é‡å’Œæ—¶é—´æ‰¯ä¸Šå…³ç³»ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…åªå¸è½½ä¸€å®šæ•°é‡çš„èµ„æºã€‚ åœ¨å¼•ç”¨è®¡æ•°ä¸­ï¼Œå¦‚æœå¼•ç”¨è®¡æ•°ä¸º0åˆ™æ ‡è®°ä¸ºå¯ä»¥å¼€å§‹å¸è½½äº†ã€‚ 1234567891011121314public class AssetBundleInfo{ public int ReferencedCount { get { return m_ReferencedCount; } set { m_ReferencedCount = value; if (m_ReferencedCount&lt;= 0) IsUnLoadFlag = true; else IsUnLoadFlag = false; } } public bool IsUnLoadFlag { get; private set; } private int m_ReferencedCount; //å¼•ç”¨è®¡æ•°} ä¸æ—¶é—´æŒ‚é’©ä¸æ—¶é—´æŒ‚é’©å°±éœ€è¦æœ‰ä¸ªåœ°æ–¹èƒ½å¤Ÿä¸€ç›´ç»Ÿè®¡å’Œè®¡ç®—æˆ‘ä»¬çš„æ—¶é—´å¹¶è¿›è¡Œå›æ”¶ 123456public class ResourceManager{ void Update(){ }} ä¾èµ–æœ¬æ–‡ä¹‹å‰çš„ä»£ç éƒ½æ˜¯æ²¡æœ‰è€ƒè™‘ä¾èµ–çš„ï¼Œæ‰€ä»¥å¦‚æœçœŸçš„è·‘èµ·æ¥ä¼šå‘ç°è®¡æ•°ä¼šæœ‰åå·®ã€‚ ä¸€ä¸ªèµ„æºèº«ä¸Šç”¨åˆ°äº†åˆ«çš„ABåŒ…ä¸­çš„èµ„æºï¼Œè¿™æ—¶å€™å¦‚æœåªåŠ è½½è‡ªèº«çš„ABåŒ…ï¼Œå°±ä¼šå‡ºç°èµ„æºä¸¢å¤±çš„æƒ…å†µã€‚è¿™æ—¶å€™å°±éœ€è¦æŠŠå½“å‰èµ„æºéœ€è¦ç”¨åˆ°çš„ä¾èµ–åŒ…ä¸€èµ·åŠ è½½å‡ºæ¥ã€‚ ä½†æ˜¯æˆ‘ä»¬åˆè¦æ€ä¹ˆçŸ¥é“è¿™ä¸ªèµ„æºä¾èµ–äºå“ªäº›åŒ…ï¼Ÿ è¿™æ—¶å€™å°±éœ€è¦ç”¨åˆ°Unityæä¾›çš„ABåŒ…ä¾èµ–æ–‡ä»¶æ¥åˆ¤æ–­ï¼Œåç¼€.manifestÂ·ã€‚ AssetBundleç¯‡TodoğŸ’â™€è¿™éƒ¨åˆ†ä»¥å‰çš„ç¬”è®°æ‰¾ä¸åˆ°äº†ï¼Œå…ˆæ¬ ç€ã€‚ çƒ­æ›´ç¯‡TodoğŸ’â™€è¿™éƒ¨åˆ†å†…å®¹å†™åœ¨åˆ«çš„åœ°æ–¹ï¼Œæ¯”è¾ƒä¹±åç»­æ•´ç†ã€‚","categories":[],"tags":[{"name":"èµ„æºç®¡ç†","slug":"èµ„æºç®¡ç†","permalink":"http://ysich.github.io/tags/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/"}]},{"title":"Luaå…¥é—¨","slug":"Luaå…¥é—¨","date":"2023-01-13T06:12:28.000Z","updated":"2023-01-14T13:05:50.879Z","comments":true,"path":"2023/01/13/Luaå…¥é—¨/","link":"","permalink":"http://ysich.github.io/2023/01/13/Lua%E5%85%A5%E9%97%A8/","excerpt":"","text":"Luaå¤§çº²æ³¨æ„ç‚¹ å¾ªç¯ç”¨doï¼Œifè¯­å¥ç”¨thenï¼Œéƒ½ä½¿ç”¨endç»“å°¾ Luaä¸æ”¯æŒè‡ªå‡å’Œè‡ªåŠ æ“ä½œï¼Œåªèƒ½i=i+1ï¼Œi=i-1 å­—ç¬¦ä¸²çš„ç¬¬ä¸€ä¸ªä½ç½®æ˜¯1ä¸æ˜¯0 æŠ€å·§ Luaçš„å­—ç¬¦ä¸²å¯ä»¥å­˜å‚¨0x00ï¼Œå¯ä»¥ç”¨å­—ç¬¦ä¸²å­˜å‚¨äºŒè¿›åˆ¶æµ æ³¨é‡Š ç”¨--å¼€å¤´ï¼Œæ¥å†™ä¸€æ®µå•è¡Œæ³¨é‡Š 1-- å•è¡Œæ³¨é‡Š ç”¨--[[å¼€å¤´ï¼Œ]]ç»“å°¾ï¼Œå†™ä¸€æ®µå¤šè¡Œæ³¨é‡Šã€‚ 1234--[[ å¤šè¡Œ æ³¨é‡Š]] å˜é‡å¯¹ä¸€ä¸ªå˜é‡è¿›è¡Œèµ‹å€¼å°±ç›¸å½“äºå£°æ˜å˜é‡ï¼Œä¸pythonç›¸ä¼¼ å£°æ˜çš„å˜é‡é»˜è®¤ä¸ºå…¨å±€å˜é‡1a=1 åŒæ—¶ç»™å¤šä¸ªå˜é‡èµ‹å€¼ï¼Œå¤šé‡èµ‹å€¼ 1a,b=1,2 å±€éƒ¨å˜é‡1local b=2 nilç±»å‹æ²¡æœ‰è¢«å£°æ˜è¿‡çš„å˜é‡éƒ½æ˜¯nil nilç±»å‹åªæœ‰ä¸€ä¸ªå€¼ï¼Œå°±æ˜¯nil nilç±»ä¼¼nullç±»å‹ if(nil)ä¸ºfalse numberç±»å‹1234--æ”¯æŒåå…­è¿›åˆ¶è¡¨ç¤ºæ–¹æ³•a=0x11--è¾“å‡ºä¸º17--ç§‘å­¦è®¡æ•°æ³•a=2e10 stringç±»å‹å•å¼•å·ã€åŒå¼•å·1234a=\"daeqeq\"b='sdarrr'--è½¬ä¹‰å­—ç¬¦\\nd=\"sdada\\nsdar\" å¤šè¡Œæ–‡æœ¬å¤šè¡Œæ–‡æœ¬æ— æ³•ä½¿ç”¨è½¬ä¹‰å­—ç¬¦ 1c=[[asdasfffrrqweqq]] å­—ç¬¦ä¸²è¿æ¥å­—ç¬¦ä¸²è¿æ¥ç¬¦å·.. 1234a=\"daeqeq\"b='sdarrr'c=a..bprint(\"asdaf\"..\"as232\") æ•°å€¼è½¬å­—ç¬¦ä¸²1tostring(10) å­—ç¬¦ä¸²è½¬æ•°å€¼tonumberè½¬æ¢å¤±è´¥ä¸ºnil 1tonumber(\"193\") è·å–å­—ç¬¦ä¸²é•¿åº¦123a=\"daeqeq\"print(#a)--ç­‰ä»·äºs:len() stringç±»å‹ç±»ä¼¼charæ•°ç»„Luaä¸­stringç±»å‹ ç±»ä¼¼äºCé‡Œçš„å­—ç¬¦æ•°ç»„ï¼Œå¯ä»¥åŒ…å«ä»»æ„æ•°å€¼åŒ…æ‹¬0x00ï¼Œå¯ä»¥å­˜å‚¨äºŒè¿›åˆ¶æµå› ä¸ºéƒ½æ˜¯åŸåŸæœ¬æœ¬å­˜å‚¨ å°†asciiç è½¬ä¸ºå­—ç¬¦ä¸²12s=string.char(65)s=string.char(0x30,0x31,0x32,0x33) å–å‡ºstringä¸­çš„æŸä¸€ä½çš„asciiç 1234n=string.byte(s,2)print(n)--è¯­æ³•ç³–ï¼Œç¬¬ä¸€ä¸ªåˆ°æœ€åä¸€ä¸ªs:byte(1ï¼Œ-1) formatè°ƒç”¨cçš„æ¥å£ 12local f=string.format(\"%d,%d\",1,2)print(f) functionå‡½æ•°å‡½æ•°é»˜è®¤è¿”å›å€¼ä¸ºnilï¼Œæ²¡æœ‰ä»»ä½•è¿”å›å€¼åˆ™ä¸ºnil 1234567function function_name() --bodyend--å‡½æ•°åæ”¾å‰é¢f=function(...) --bodyend 123456function f(a,b,c) print(a,b,c) return aend--cæ²¡æœ‰ä¼ å€¼åˆ™ä¸ºnilprint(f(1,2))--1 å‡½æ•°å¯ä»¥è¿”å›å¤šä¸ªå€¼12345function f(a,b,c) return a,bendprint(f(1,2)) å¤šä¸ªè¿”å›å€¼å¯ä»¥ä½¿ç”¨å¤šé‡èµ‹å€¼è¯­å¥12345function f(a,b,c) return a,bendlocal i,j=f(1,2) tabletableæ¥å£123table.insert(a,\"d\")--æ’å…¥å…ƒç´ ï¼Œæœ«å°¾æ·»åŠ table.insert(a,2,\"d\")--æ’å…¥å…ƒç´ ï¼Œç¬¬äºŒä¸ªä½ç½®ï¼Œåç»­å…ƒç´ åç§»local s= table.remove(a,2)--ç§»é™¤ç¬¬2ä¸ªå…ƒç´  tableæ•°å­—ä¸‹æ ‡å¯ä»¥å­˜æ‰€æœ‰ä¸œè¥¿(number,string,table,function) 12345a={1,\"ac\",{},function() end}a[5]=123 --å¯ä»¥ç›´æ¥æ·»åŠ ä¸€ä¸ªå…ƒç´ print(a[1])--è·å–tableé•¿åº¦print(#a) tableå­—ç¬¦ä¸²ä¸‹æ ‡ä»¥å­—ç¬¦ä¸ºtableçš„ä¸‹æ ‡ 12345678910a={ a=1, b=\"1234\", c=function() end, d=123123}print(a[\"a\"])--ä¸‹æ ‡ç¬¦åˆå˜é‡å‘½åè§„èŒƒæ—¶print(a.a) å…¨å±€è¡¨_GLuaå†…çš„æ‰€æœ‰å…¨å±€å˜é‡éƒ½åœ¨_Gè¿™ä¸ªtableå†… åŒ…æ‹¬table.insertä¸­çš„table(ä¹Ÿæ˜¯å…¨å±€å˜é‡)ä¹Ÿå­˜å‚¨åœ¨_Gä¸­ï¼Œinsertä¸ºtableçš„ä¸‹æ ‡ 1234print(_G[\"table\"][\"insert\"])--function: 0000000063be4590--è¾“å‡ºå€¼ä¸ºä¸€ä¸ªå‡½æ•°--å¤šæ–‡ä»¶è°ƒç”¨çŸ¥è¯† å¸ƒå°”å‹ä¸ç­‰äºåœ¨Luaä¸­ä¸ç­‰äºä½¿ç”¨~=è¡¨ç¤º 123456789a=trueb=falseprint(1&gt;2)print(1&lt;2)print(1&gt;=2)print(1&lt;=2)print(1==2)--ä¸ç­‰äºprint(1~=2) ä¸æˆ–éåªæœ‰falseå’Œnilè¡¨ç¤ºå‡å…¶ä»–éƒ½è¡¨ç¤ºçœŸï¼ŒåŒ…æ‹¬0 123print(a and b)print(a or b)print(not a) and``orè¿”å›çš„å¹¶ä¸å®Œå…¨æ˜¯trueå’Œfalseï¼Œä¼šç›´æ¥è¿”å›aæˆ–è€…bçš„å€¼ï¼Œå¯ä»¥é€šè¿‡çŸ­è·¯æ±‚å€¼ åªæœ‰notè¿”å›trueå’Œfalse 123456a=nil --çœŸb=0 --å‡print(a and b) --nilprint(a or b) --0print(not a) --trueprint(b&gt;10 and \"yes\" or \"no\") --no åˆ†æ”¯åˆ¤æ–­ifè¯­å¥1234567if 1&gt;10 then print(\"1&gt;10\")elseif 1&lt;10 then print(\"1&lt;10\")else print(\"no\")end å¾ªç¯forå¾ªç¯1234567for i=1,10 do print(i)end--æ­¥é•¿ä¸º2for i=1,10,2 do print(i)end å€’åºå¾ªç¯123for i=10,1,-1 do print(i)end iåœ¨è¿‡ç¨‹é€”ä¸­ä¸èƒ½èµ‹å€¼ï¼Œèµ‹å€¼äº†ä¹Ÿæ²¡ç”¨ å‡å¦‚å¯¹ièµ‹å€¼ä¼šè¢«è®¤å®šä¸ºæ–°å»ºäº†å±€éƒ¨å˜é‡ 1234for i=10,1,-1 do print(i) local i=1end breaké€šè¿‡breaké€€å‡ºå¾ªç¯ 1234for i=10,1,-1 do print(i) if i == 5 then break endend whileå¾ªç¯12345n = 10while n&gt;1 do print(n) n = n - 1end repeatå¾ªç¯å’Œwhileå¾ªç¯åŸºæœ¬ä¸€è‡´ å¤šæ–‡ä»¶è°ƒç”¨requireå’Œimportçš„åŒºåˆ«requireå®ç°æ¢ä¸ªç›®å½•åå°±éœ€è¦å¯¹è·¯å¾„è¿›è¡Œå˜æ›´ ä¸ªäººç†è§£ï¼šç»å¯¹è·¯å¾„ 12345local MyClassBase = require(\"app.classes.MyClassBase\")local MyClass = class(\"MyClass\", MyClassBase)local Data1 = require(\"app.classes.data.Data1\")local Data2 = require(\"app.classes.data.Data2\") importå®ç°åœ¨æ¨¡å—åå‰æ·»åŠ å¤šä¸ªâ€.â€ ï¼Œè¿™æ · import() ä¼šä»æ›´ä¸Šå±‚çš„ç›®å½•å¼€å§‹æŸ¥æ‰¾æ¨¡å—ã€‚ ä¸ªäººç†è§£ï¼šç›¸å¯¹è·¯å¾„ 12345local MyClassBase = import(\".MyClassBase\")local MyClass = class(\"MyClass\", MyClassBase)local Data1 = import(\".data.Data1\")local Data2 = import(\".data.Data2\") requireè¿è¡ŒæŒ‡å®šå¤šæ–‡ä»¶ æœ«å°¾ä¸å¸¦æ‰©å±•å 12--.\\?lua æŠŠæ–‡ä»¶ååŒ¹é…åˆ°ï¼Ÿå†…require(\"æ–‡ä»¶å\") ä¸åŒå±‚æ¶æ–‡ä»¶å¤¹ç”¨.åˆ†éš” 1require(\"æ–‡ä»¶å¤¹å.æ–‡ä»¶å\") åªä¼šè¿è¡Œä¸€æ¬¡ 12345678--luaæ–‡ä»¶æœ‰å¯ä»¥returnè¿”å›å€¼local r = require('hello')--åé¢è°ƒç”¨çš„éƒ½æ˜¯å‰é¢è¿”å›çš„å†…å®¹require('hello')require('hello')require('hello')require('hello')print(r) package.path12package.path=package.path..\";./path/?.lua\"require('hello2') å¤šæ¬¡è°ƒç”¨è°ƒç”¨luaæ–‡ä»¶å†…çš„å‡½æ•° 123456789101112--hello.lualocal hello={}function hello.say() print(\"hello world\")end//é€šè¿‡è¿”å›tablereturn hello--test.lualocal test=require('hello')//é€šè¿‡tableå†…çš„æ–¹æ³•è°ƒç”¨test.say() è¿­ä»£table1234t={\"a\",\"b\",\"c\",\"d\"}for i=1,#t,do print(i,t[i])end è¿­ä»£å™¨ipairsçº¯æ•°å­—è¿ç»­ä¸‹æ ‡å¯ä»¥ç”¨ 12345t={\"a\",\"b\",\"c\",\"d\"}--ä¸‹æ ‡ç»™iï¼Œå€¼ç»™jfor i,j in ipairs(t) do print(i,j)end 1234567891011t={ [1]=\"a\", [2]=\"b\", [3]=\"c\", [5]=\"d\"}--ä¸‹æ ‡ç»™iï¼Œå€¼ç»™jfor i,j in ipairs(t) do --åªèƒ½éå†åˆ°1åˆ°3ï¼Œä¸è¿ç»­çš„åé¢éå†ä¸åˆ° print(i,j)end è¿­ä»£å™¨pairså¯ä»¥éå†æ‰€æœ‰ä¸‹æ ‡ pairså†…éƒ¨è°ƒç”¨çš„æ˜¯nextå‡½æ•° 1234567891011t={ [1]=\"a\", [2]=\"b\", [3]=\"c\", [5]=\"d\"}--ä¸‹æ ‡ç»™iï¼Œå€¼ç»™jfor i,j in pairs(t) do --åªèƒ½éå†åˆ°1åˆ°3ï¼Œä¸è¿ç»­çš„åé¢éå†ä¸åˆ° print(i,j)end 1234567891011t={ apple=\"a\", banana=\"b\", eraser=\"c\", water=\"d\"}--ä¸‹æ ‡ç»™iï¼Œå€¼ç»™jfor i,j in pairs(t) do --åªèƒ½éå†åˆ°1åˆ°3ï¼Œä¸è¿ç»­çš„åé¢éå†ä¸åˆ° print(i,j)end å…ƒè¡¨ã€å…ƒæ–¹æ³•è¯­æ³•ç³–12345678t={ a=0, add=function(tab,num) tab.a=tab.a+num end}--ç±»ä¼¼äºé¢å‘å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨t:add(10)--ç­‰ä»·äºt.add(t,10) é¢å‘å¯¹è±¡123456789101112131415161718192021222324--å¯¹è±¡åbag={}bagmt={ --è£…å…¥ä¸œè¥¿çš„å‡½æ•° put=function(t,item) table.insert(t.items,item) end, take=function(t) return table.remove(t) end, list=function(t) return table.concat(t.items,\",\") end}bagmt[\"__index\"]=bagmt--æ„é€ å‡½æ•°function bag.new() local t={ items={} } setmetatable(t,bagmt) return tend åç¨‹coroutineä¸€ä¸ªluaè™šæ‹Ÿæœºé‡Œåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹ coroutine.create å¯åˆ›å»ºä¸€ä¸ªåç¨‹è¿”å›å€¼ä¸º thread ç±»å‹ 123456local co=coroutine.create( function() print(\"hello world!\") end )","categories":[],"tags":[{"name":"Lua","slug":"Lua","permalink":"http://ysich.github.io/tags/Lua/"}]}],"categories":[],"tags":[{"name":"èµ„æºç®¡ç†","slug":"èµ„æºç®¡ç†","permalink":"http://ysich.github.io/tags/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/"},{"name":"Lua","slug":"Lua","permalink":"http://ysich.github.io/tags/Lua/"}]}